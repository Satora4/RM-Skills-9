<link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">

<div class="toggleGroup">
  <label>Bereits gespielte Partien anzeigen</label>
  <mat-slide-toggle class="toggle" (change)="onChange($event)"></mat-slide-toggle>
</div>

<div class="groups" *ngFor="let dataObject of dataObjects">
  <div class="list">
    <h2>{{dataObject.groupDate}}</h2>
    <table mat-table [dataSource]="dataObject.dataSource">

      <ng-container matColumnDef="gameTime">
        <th mat-header-cell *matHeaderCellDef>Datum</th>
        <td mat-cell
            *matCellDef="let gameTableModel">{{gameTableModel.game.gameTime | date:'d MMM y | HH:mm'}}</td>
      </ng-container>

      <ng-container matColumnDef="teamCountry1">
        <th mat-header-cell *matHeaderCellDef>Team 1</th>
        <td mat-cell *matCellDef="let gameTableModel">{{gameTableModel.game.team1.country}}</td>
      </ng-container>

      <ng-container matColumnDef="flag1">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel" style="text-align: center"><i
          class="em {{gameTableModel.game.team1.countryFlag}}"
          aria-role="presentation"></i></td>
      </ng-container>

      <ng-container matColumnDef="pointsTeam1">
        <th mat-header-cell *matHeaderCellDef>Punkte von Team 1</th>
        <td mat-cell *matCellDef="let gameTableModel"
            style="text-align: center">{{gameTableModel.game.pointsTeam1}}</td>
      </ng-container>

      <ng-container matColumnDef="colon">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel">:</td>
      </ng-container>

      <ng-container matColumnDef="pointsTeam2">
        <th mat-header-cell *matHeaderCellDef>Punkte von Team 2</th>
        <td mat-cell *matCellDef="let gameTableModel"
            style="text-align: center">{{gameTableModel.game.pointsTeam2}}</td>
      </ng-container>

      <ng-container matColumnDef="flag2">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel" style="text-align: center"><i
          class="em {{gameTableModel.game.team2.countryFlag}}"
          aria-role="presentation"></i></td>
      </ng-container>

      <ng-container matColumnDef="teamCountry2">
        <th mat-header-cell *matHeaderCellDef>Team 2</th>
        <td mat-cell *matCellDef="let gameTableModel">{{gameTableModel.game.team2.country}}</td>
      </ng-container>

      <div>
        <ng-container matColumnDef="tipTeam1">
          <th mat-header-cell style="margin-right: 2em;" *matHeaderCellDef>Tipp Team1</th>
          <td mat-cell *matCellDef="let gameTableModel">

            <mat-form-field *ngIf="insertingTipIsAllowed(gameTableModel.game); else showTipTeam1">
              <input matInput
                     maxlength="2" type="text"
                     [placeholder]="dash" [(ngModel)]="tipTeam1[gameTableModel.game.id]"
                     [formControl]="gameTableModel.formControlTip1" [errorStateMatcher]="matcher">

              <br>
              <mat-error
                *ngIf="gameTableModel.formControlTip1.hasError('pattern') &&
              !gameTableModel.formControlTip1.hasError('required')"></mat-error>
            </mat-form-field>

            <ng-template #showTipTeam1>
              <ng-container *ngIf="getTipByGameId(gameTableModel.game.id) != null; else showDash">
                {{getTipByGameId(gameTableModel.game.id)?.tipTeam1}}
              </ng-container>

              <ng-template #showDash>
                {{dash}}
              </ng-template>
            </ng-template>

          </td>
        </ng-container>

        <ng-container matColumnDef="tipTeam2">
          <th mat-header-cell *matHeaderCellDef>Tipp Team2</th>
          <td mat-cell *matCellDef="let gameTableModel">
            <mat-form-field *ngIf="insertingTipIsAllowed(gameTableModel.game); else showTipTeam2">
              <input matInput
                     maxlength="2" type="text"
                     [placeholder]="dash" [(ngModel)]="tipTeam2[gameTableModel.game.id]"
                     [formControl]="gameTableModel.formControlTip2" [errorStateMatcher]="matcher">

              <br>
              <mat-error
                *ngIf="(gameTableModel.formControlTip2.hasError('pattern')) &&
            !gameTableModel.formControlTip2.hasError('required')"></mat-error>
            </mat-form-field>

            <ng-template #showTipTeam2>
              <ng-container *ngIf="getTipByGameId(gameTableModel.game.id) != null; else showDash">
                {{getTipByGameId(gameTableModel.game.id)?.tipTeam2}}
              </ng-container>

              <ng-template #showDash>
                {{dash}}
              </ng-template>
            </ng-template>

          </td>
        </ng-container>
      </div>

      <ng-container matColumnDef="button">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel">
          <button
            *ngIf="insertingTipIsAllowed(gameTableModel.game); else showEditButton"
            mat-stroked-button
            (click)="saveTip(tipTeam1[gameTableModel.game.id], tipTeam2[gameTableModel.game.id], gameTableModel.game)">
            <span class="material-icons">save</span>
          </button>

          <ng-template #showEditButton>
            <button
              *ngIf="editingTipIsAllowed(gameTableModel.game);"
              mat-stroked-button
              (click)="openTipWindow(gameTableModel.game)">
              <span class="material-icons">edit</span>
            </button>
          </ng-template>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>

    </table>
  </div>
</div>
