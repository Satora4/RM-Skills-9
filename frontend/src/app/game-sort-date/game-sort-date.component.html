<link href="https://emoji-css.afeld.me/emoji.css" rel="stylesheet">


<mat-slide-toggle class="toggle" (change)="onChange($event)">Alle Spiele anzeigen</mat-slide-toggle>
<div class="groups" *ngFor="let dataObject of dataObjects">
  <div class="list">
    <h2>{{dataObject.groupDate}}</h2>
    <table mat-table [dataSource]="dataObject.dataSource">

      <ng-container matColumnDef="gameTime">
        <th mat-header-cell *matHeaderCellDef>Datum</th>
        <td mat-cell
            *matCellDef="let gameTableModel">{{gameTableModel.game.gameTime | date:'d MMM y | HH:mm'}}</td>
      </ng-container>

      <ng-container matColumnDef="gameLocation">
        <th mat-header-cell *matHeaderCellDef>Ort</th>
        <td mat-cell *matCellDef="let gameTableModel">{{gameTableModel.game.gameLocation}}</td>
      </ng-container>

      <ng-container matColumnDef="teamCountry1">
        <th mat-header-cell *matHeaderCellDef>Team 1</th>
        <td mat-cell *matCellDef="let gameTableModel">{{gameTableModel.game.team1.country}}</td>
      </ng-container>
      <ng-container matColumnDef="flag1">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel" style="text-align: center"><i
          class="em {{gameTableModel.game.team1.countryFlag}}"
          aria-role="presentation"></i></td>
      </ng-container>

      <ng-container matColumnDef="pointsTeam1">
        <th mat-header-cell *matHeaderCellDef>Punkte von Team 1</th>
        <td mat-cell *matCellDef="let gameTableModel"
            style="text-align: center">{{gameTableModel.game.pointsTeam1}}</td>
      </ng-container>

      <ng-container matColumnDef="colon">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel">:</td>
      </ng-container>

      <ng-container matColumnDef="pointsTeam2">
        <th mat-header-cell *matHeaderCellDef>Punkte von Team 2</th>
        <td mat-cell *matCellDef="let gameTableModel"
            style="text-align: center">{{gameTableModel.game.pointsTeam2}}</td>
      </ng-container>

      <ng-container matColumnDef="flag2">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel" style="text-align: center"><i
          class="em {{gameTableModel.game.team2.countryFlag}}"
          aria-role="presentation"></i></td>
      </ng-container>

      <ng-container matColumnDef="teamCountry2">
        <th mat-header-cell *matHeaderCellDef>Team 2</th>
        <td mat-cell *matCellDef="let gameTableModel">{{gameTableModel.game.team2.country}}</td>
      </ng-container>

      <div>
        <ng-container matColumnDef="tipTeam1">
          <th mat-header-cell *matHeaderCellDef>Tipp Team1</th>
          <td mat-cell *matCellDef="let gameTableModel">
            <input matInput
                   *ngIf="gameTableModel.game.pointsTeam1 == null && getTipTeam1ByGameId(gameTableModel.game.id) == null; else showTipTeam1"
                   maxlength="2" type="text"
                   [placeholder]="dash" [(ngModel)]="tipTeam1[gameTableModel.game.id]"
                   [formControl]="gameTableModel.formControlTip1" [errorStateMatcher]="matcher">

            <br>
            <mat-error
              *ngIf="gameTableModel.formControlTip1.hasError('pattern') &&
              !gameTableModel.formControlTip1.hasError('required')">{{errorMessage}}</mat-error>

            <ng-template #showTipTeam1>
              {{getTipTeam1ByGameId(gameTableModel.game.id)}}
            </ng-template>
          </td>
        </ng-container>

        <ng-container matColumnDef="tipTeam2">
          <th mat-header-cell *matHeaderCellDef>Tipp Team2</th>
          <td mat-cell *matCellDef="let gameTableModel">
            <input matInput
                   *ngIf="gameTableModel.game.pointsTeam2 == null && getTipTeam2ByGameId(gameTableModel.game.id) == null; else showTipTeam2"
                   maxlength="2" type="text"
                   [placeholder]="dash" [(ngModel)]="tipTeam2[gameTableModel.game.id]"
                   [formControl]="gameTableModel.formControlTip2" [errorStateMatcher]="matcher">

            <br>
            <mat-error
              *ngIf="(gameTableModel.formControlTip2.hasError('pattern')) &&
            !gameTableModel.formControlTip2.hasError('required')">{{errorMessage}}</mat-error>

            <ng-template #showTipTeam2>
              {{getTipTeam2ByGameId(gameTableModel.game.id)}}
            </ng-template>
          </td>
        </ng-container>
      </div>

      <ng-container matColumnDef="button">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let gameTableModel">
          <button
            *ngIf="gameTableModel.game.pointsTeam1 == null && getTipTeam1ByGameId(gameTableModel.game.id) == null; else showEditButton"
            mat-stroked-button
            (click)="saveTip(tipTeam1[gameTableModel.game.id], tipTeam2[gameTableModel.game.id], gameTableModel.game)">
            save
          </button>

          <ng-template #showEditButton>
            <button
              *ngIf="gameTableModel.game.pointsTeam1 == null && getTipTeam1ByGameId(gameTableModel.game.id) != null;"
              mat-stroked-button
              (click)="openTipWindow(gameTableModel.game)">edit
            </button>
          </ng-template>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
      <tr mat-row *matRowDef="let row; columns: columnsToDisplay;"></tr>

    </table>
  </div>
</div>
